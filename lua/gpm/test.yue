import Promise, Error, debug from gpm
import async, await from Promise
import format from string
SysTime = SysTime

iter = 10000
warmup = math.min( iter / 100, 100 )
bench = (name, fn) ->
    -- Warmup
    for i = 1, warmup
        fn!

    collectgarbage "stop"
    st = SysTime!

    for i = 1, iter
        fn!

    st = SysTime! - st
    collectgarbage "restart"
    print format( "%d iterations of %s, took %f sec.", iter, name, st )
    return st

main = async ->
    -- gpm.Import( "dll://asyncio" )
    -- PrintTable gpm.Import( "file:/addons/NikNaks-main.zip")
    -- gpm.Import( "file:/lua/packages/b/init" )

main!\Catch (err)->
    try Error.display err
    catch err
        ErrorNoHaltWithStack err
        return
    return
